<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Page Baru</title>
  <!-- Sertakan CSS dan resource lain jika diperlukan -->
  <link rel="stylesheet" href="style.css">
  <!-- Font Modern -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
  <style>
    /* Styling untuk tabel */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px 12px;
      text-align: left;
    }
    th {
      background: #f4f4f4;
    }
    /* Footer Styling */
    footer {
      background: #3949ab;
      color: #fff;
      text-align: center;
      padding: 20px 10px;
      margin-top: 40px;
    }
    footer a {
      color: #ffca28;
      margin: 0 5px;
    }
    /* Input filter */
    #filterInput, #dateFrom, #dateTo, #cabangFilter {
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%; /* agar input full width */
    }
    #filterSection {
      margin: 20px 0;
    }
    #filterSection label {
      margin-right: 10px;
    }
    /* Responsif untuk mobile */
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { border: 1px solid #ccc; }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 50%;
        white-space: normal;
        text-align: left;
      }
      td:before {
        position: absolute;
        top: 6px;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align: left;
      }
      td:nth-of-type(1):before { content: "Tanggal Jual"; }
      td:nth-of-type(2):before { content: "Cabang"; }
      td:nth-of-type(3):before { content: "Wilayah"; }
      td:nth-of-type(4):before { content: "Supervisor/Field"; }
      td:nth-of-type(5):before { content: "Salesman"; }
      td:nth-of-type(6):before { content: "Nama Customer"; }
      td:nth-of-type(7):before { content: "KECAMATAN"; }
      td:nth-of-type(8):before { content: "Pembayaran"; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Detail</h1>
    <nav>
      <a href="index.html">Kembali ke Dashboard</a>
    </nav>
  </header>
  <main>
    <!-- Bagian untuk semua filter -->
    <div id="filterSection">
      <!-- Filter Global (cari teks di semua kolom) -->
      <label>
        Filter Teks:
        <input type="text" id="filterInput" placeholder="Cari data...">
      </label>
      <!-- Filter Date From dan Date To -->
      <label>
        Date From:
        <input type="date" id="dateFrom">
      </label>
      <label>
        Date To:
        <input type="date" id="dateTo">
      </label>
      <!-- Filter kolom Cabang -->
      <label>
        Cabang:
        <input type="text" id="cabangFilter" placeholder="Nama Cabang...">
      </label>
    </div>

    <!-- Tabel dengan header yang telah ditentukan -->
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>Tanggal Jual</th>
            <th>Cabang</th>
            <th>Wilayah</th>
            <th>Supervisor/Field</th>
            <th>Salesman</th>
            <th>Nama Customer</th>
            <th>KECAMATAN</th>
            <th>Pembayaran</th>
          </tr>
        </thead>
        <tbody id="data-table">
          <!-- Data dari Google Sheets akan dimuat di sini -->
        </tbody>
      </table>
    </div>
  </main>
  <footer>
    <p>&copy; 2025 Nama Perusahaan. All rights reserved.</p>
    <p>
      <a href="#">Facebook</a> | 
      <a href="#">Twitter</a> | 
      <a href="#">Instagram</a>
    </p>
    <p>Sumber Data: Google Sheets &amp; API. Info lebih lanjut hubungi <a href="mailto:agungsamodraa@gmail.com">agungsamodraa@gmail.com</a></p>
  </footer>
  
  <script>
    // Fungsi untuk mengambil data dari URL web Apps Script
    function getDataFromSheet() {
      // Ganti URL berikut dengan URL web Apps Script Anda yang telah dipublish
      const sheetUrl = 'https://script.google.com/macros/s/AKfycbwV4ZymIjEwWDxEBMZYZ4Y65WpUDGu4ijSQL6H0RYp6BCapNugYy5cPI9lGOQscTKm4/exec';
      
      fetch(sheetUrl)
        .then(response => response.json())
        .then(data => {
          console.log("Data diterima:", data);

          // Jika data diambil dari properti DP_1, gunakan data.DP_1
          // Sesuaikan dengan struktur JSON Anda.
          let rows = data.DP_1 || data;

          // Asumsikan baris pertama berisi header, kita lewati
          let tableContent = '';
          for (let i = 1; i < rows.length; i++) {
            let row = rows[i];
            
            // Parse tanggal di kolom [2] (sesuaikan dengan kolom sebenarnya)
            let rawDate = row[2] || ''; 
            let formattedDate = '';

            // Coba parse string menjadi Date
            if (rawDate) {
              let dateObj = new Date(rawDate);
              // Pastikan valid
              if (!isNaN(dateObj.getTime())) {
                let day = String(dateObj.getDate()).padStart(2, '0');
                let month = String(dateObj.getMonth() + 1).padStart(2, '0');
                let year = dateObj.getFullYear();
                formattedDate = `${day}/${month}/${year}`;
              } else {
                // Jika gagal parse, tampilkan rawDate apa adanya
                formattedDate = rawDate;
              }
            }

            // Bangun isi tabel (sesuaikan index kolom)
            tableContent += '<tr>';
            tableContent += `<td>${formattedDate}</td>`;     // 0 - Tanggal (dd/mm/yyyy)
            tableContent += `<td>${row[1] || ''}</td>`;      // 1 - Cabang
            tableContent += `<td>${row[63] || ''}</td>`;     // 2 - Wilayah
            tableContent += `<td>${row[44] || ''}</td>`;     // 3 - Supervisor/Field
            tableContent += `<td>${row[36] || ''}</td>`;     // 4 - Salesman
            tableContent += `<td>${row[9] || ''}</td>`;      // 5 - Nama Customer
            tableContent += `<td>${row[12] || ''}</td>`;     // 7 - KECAMATAN
            tableContent += `<td>${row[33] || ''}</td>`;     // 6 - Pembayaran
            tableContent += '</tr>';
          }

          // Masukkan ke dalam tbody
          document.getElementById('data-table').innerHTML = tableContent;

          // Setelah data dimuat, set event listener untuk filter
          initFilter();
        })
        .catch(error => {
          console.error('Error loading data:', error);
        });
    }

    // Inisialisasi event listener pada semua input filter
    function initFilter() {
      const filterInput = document.getElementById('filterInput');    // filter teks global
      const dateFromInput = document.getElementById('dateFrom');     // filter date from
      const dateToInput = document.getElementById('dateTo');         // filter date to
      const cabangInput = document.getElementById('cabangFilter');   // filter cabang

      // Ketika ada perubahan (atau ketikan) pada filter input, panggil fungsi filter
      filterInput.addEventListener('input', applyFilter);
      dateFromInput.addEventListener('input', applyFilter);
      dateToInput.addEventListener('input', applyFilter);
      cabangInput.addEventListener('input', applyFilter);
    }

    // Fungsi untuk menerapkan filter pada tabel
    function applyFilter() {
      const filterValue = document.getElementById('filterInput').value.toUpperCase();
      const dateFrom = new Date(document.getElementById('dateFrom').value);
      const dateTo = new Date(document.getElementById('dateTo').value);
      const cabangValue = document.getElementById('cabangFilter').value.toUpperCase();

      // Ambil semua baris dari tabel, kecuali header (thead)
      const tr = document.getElementById('data-table').getElementsByTagName('tr');
      for (let i = 0; i < tr.length; i++) {
        const tds = tr[i].getElementsByTagName('td');
        if (!tds.length) continue; // lanjut ke baris berikutnya jika tidak ada sel data (td)

        // 1. Cek Filter Global (cari teks di semua kolom)
        // ----------------------------
        if (tanggalText.toUpperCase().indexOf(filterValue) > -1 ||
            cabangText.indexOf(filterValue) > -1 ||
            tds[2].textContent.trim().toUpperCase().indexOf(filterValue) > -1 ||
            tds[3].textContent.trim().toUpperCase().indexOf(filterValue) > -1 ||
            tds[4].textContent.trim().toUpperCase().indexOf(filterValue) > -1 ||
            tds[5].textContent.trim().toUpperCase().indexOf(filterValue) > -1 ||
            tds[6].textContent.trim().toUpperCase().indexOf(filterValue) > -1 ||
            tds[7].textContent.trim().toUpperCase().indexOf(filterValue) > -1) {
          tr[i].style.display = '';
        } else {
          tr[i].style.display = 'none';
          continue; // lanjut ke baris berikutnya jika tidak sesuai
        }

        // 2. Cek Filter Date (From & To)
        // ----------------------------
        let rowDate = new Date(tanggalText.split('/').reverse().join('-')); // konversi ke format "YYYY-MM-DD"

        if (dateFrom && rowDate < dateFrom) {
          tr[i].style.display = 'none';
          continue; // lanjut ke baris berikutnya jika tidak sesuai
        }

        if (dateTo && rowDate > dateTo) {
          tr[i].style.display = 'none';
          continue; // lanjut ke baris berikutnya jika tidak sesuai
        }

        // 3. Cek Filter Cabang
        // ----------------------------
        if (cabangValue && cabangText.indexOf(cabangValue) === -1) {
          tr[i].style.display = 'none';
          continue; // lanjut ke baris berikutnya jika tidak sesuai
        }

        // Jika berhasil melewati semua filter, tampilkan baris
        tr[i].style.display = '';
      }
    }

    // Panggil fungsi utama untuk mengambil dan menampilkan data
    getDataFromSheet();
  </script>
</body>
</html>
